<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password | ჩემი ქალაქი</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Use your main style.css OR auth.css -->
  <link rel="stylesheet" href="auth.css">
</head>

<body class="auth-body">

  <div class="auth-card">
    <h2>პაროლის შეცვლა</h2>
    <p class="auth-subtitle">
      შეიყვანეთ ახალი პაროლი თქვენი ანგარიშისთვის
    </p>

    <input
      type="password"
      id="newPassword"
      placeholder="ახალი პაროლი"
    >

    <button id="resetBtn">
      პაროლის შეცვლა
    </button>

      <div class="back-home">
      <a href="index.html">← მთავარი გვერდი</a>
  </div>

    <p id="msg" class="auth-message"></p>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAXNVOlyzRhpVh7lJ6LC39ngr_D_98_Gak",
  authDomain: "mycityapp-b26e4.firebaseapp.com",
  projectId: "mycityapp-b26e4",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Get oobCode from URL
const params = new URLSearchParams(window.location.search);
const oobCode = params.get("oobCode");

document.getElementById("resetBtn").onclick = async () => {
  const newPassword = document.getElementById("newPassword").value;
  const msg = document.getElementById("msg");

  if (!oobCode) {
    msg.className = "auth-message error";
    msg.textContent = "ბმული არასწორია ან ვადაგასულია.";
    return;
  }

  if (newPassword.length < 6) {
    msg.className = "auth-message error";
    msg.textContent = "პაროლი უნდა შეიცავდეს მინიმუმ 6 სიმბოლოს.";
    return;
  }

  try {
    await confirmPasswordReset(auth, oobCode, newPassword);
    msg.className = "auth-message success";
    msg.textContent = "პაროლი წარმატებით შეიცვალა ✅";
  } catch (err) {
    msg.className = "auth-message error";
    msg.textContent = "ბმული ვადაგასულია ან უკვე გამოყენებულია.";
  }
};
</script>

</body>
</html>
