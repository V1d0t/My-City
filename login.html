<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login | ჩემი ქალაქი</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">
</head>
<body>

<div class="overlay">
    <div class="home-container">
        <h1 class="title" id="auth-title">შესვლა</h1>

        <form class="form" id="login-form">
            <input type="email" id="email" placeholder="ელ. ფოსტა" required maxlength="50">
            <input type="password" id="password" placeholder="პაროლი" required minlength="8" maxlength="30">
            <button type="submit" class="btn register">შესვლა</button>
        </form>

        <form class="form" id="reset-form">
            <p style="color: #fff; font-size: 14px; margin-bottom: 15px; text-align: center;">შეიყვანეთ ელ-ფოსტა პაროლის აღსადგენად</p>
            <input type="email" id="reset-email" placeholder="ელ. ფოსტა" required maxlength="50">
            <button type="submit" class="btn register">ბმულის გაგზავნა</button>
            <button type="button" id="back-to-login" class="btn-back-text">უკან დაბრუნება</button>
        </form>

        <p class="subtitle" id="main-subtitle">
            დაბრუნება <a href="index.html" style="color:#bbf7d0;">მთავარ გვერდზე</a>
        </p>

        <div class="auth-actions" id="forgot-password-area">
            <button type="button" id="forgot-password-btn" class="btn-link">დაგავიწყდათ პაროლი?</button>
        </div>
    </div>
</div>

<footer class="main-footer">
    <div class="footer-grid">
        <div class="footer-section">
            <h3 class="footer-logo">ჩემი ქალაქი</h3>
            <p>ერთად ვიზრუნოთ ჩვენს ქალაქზე. დაამყარე წესრიგი, სისუფთავე და უსაფრთხოება შენი ჩართულობით.</p>
        </div>
        <div class="footer-section">
            <h4>წარმმართველი პრინციპები</h4>
            <div class="footer-links-container">
                <a href="terms.html" class="footer-link">წესები და პირობები</a>
                <a href="privacy.html" class="footer-link">კონფიდენციალურობა</a>
                <a href="how-it-works.html" class="footer-link">როგორ მუშაობს?</a>
                <a href="contact.html" class="footer-link">კონტაქტი</a>
            </div>
        </div>
        <div class="footer-section">
            <h4>კონტაქტი</h4>
            <p>📞 +995 XXX XX XX XX</p>
            <p>📧 support@mycity.ge</p>
            <p>📍 ქუთაისი, საქართველო</p>
        </div>
        <div class="footer-section">
            <h4>გამოგვყევით</h4>
            <div class="social-icons">
                <a href="#">Facebook</a>
                <a href="#">Instagram</a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        &copy; 2026 ჩემი ქალაქი. ყველა უფლება დაცულია.
    </div>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAXNVOlyzRhpVh7lJ6LC39ngr_D_98_Gak",
        authDomain: "mycityapp-b26e4.firebaseapp.com",
        projectId: "mycityapp-b26e4",
        storageBucket: "mycityapp-b26e4.firebasestorage.app",
        messagingSenderId: "318927416494",
        appId: "1:318927416494:web:85d98e04ccd02899cf913f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Get Elements
    const loginForm = document.getElementById('login-form');
    const resetForm = document.getElementById('reset-form');
    const authTitle = document.getElementById('auth-title');
    const forgotArea = document.getElementById('forgot-password-area');
    const mainSubtitle = document.getElementById('main-subtitle');

    // 1. Handle Login
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        try {
            await signInWithEmailAndPassword(auth, email, password);
            window.location.href = "map.html"; 
        } catch (error) {
            alert("ავტორიზაციის შეცდომა: მონაცემები არასწორია.");
        }
    });

// 2. Switch to Reset Mode
    document.getElementById('forgot-password-btn').onclick = () => {
        loginForm.style.display = 'none';
        forgotArea.style.display = 'none';
        mainSubtitle.style.display = 'none';
        
        // Use 'block' to keep the vertical stacking from your CSS
        resetForm.style.display = 'block'; 
        authTitle.innerText = "პაროლის აღდგენა";
    };

    // 3. Switch back to Login Mode
    document.getElementById('back-to-login').onclick = () => {
        resetForm.style.display = 'none';
        
        // Use 'block' here too so it returns to normal
        loginForm.style.display = 'block'; 
        forgotArea.style.display = 'block';
        mainSubtitle.style.display = 'block';
        authTitle.innerText = "შესვლა";
    };

    // 4. Handle Reset Email Action
    resetForm.onsubmit = async (e) => {
        e.preventDefault();
        const emailValue = document.getElementById('reset-email').value;

        try {
            await sendPasswordResetEmail(auth, emailValue);
            alert("ბმული გამოგზავნილია! შეამოწმეთ ელ-ფოსტა ან Spam ფოლდერი.");
            document.getElementById('back-to-login').click(); // Go back to login screen
        } catch (error) {
            alert("შეცდომა: " + error.message);
        }
    };
</script>

</body>
</html>